# weiboPorter 微博搬运工

- [weiboPorter](#weiboporter-微博搬运工)
  - [功能](#功能)
  - [输出](#输出)
  - [实例](#实例)
  - [运行环境](#运行环境)
  - [使用说明](#使用说明)
    - [1.下载脚本](#1下载脚本)
    - [2.安装依赖](#2安装依赖)
    - [3.程序设置](#3程序设置)
    - [4.设置数据库（可选）](#4设置数据库可选)
    - [5.运行脚本](#5运行脚本)
    - [6.按需求修改脚本（可选）](#6按需求修改脚本可选)
    - [7.定期自动爬取微博（可选）](#7定期自动爬取微博可选)
    - [8.使用docker](#8使用docker)
  - [如何获取user_id](#如何获取user_id)
  - [添加cookie与不添加cookie的区别（可选）](#添加cookie与不添加cookie的区别可选)
  - [如何获取cookie（可选）](#如何获取cookie可选)
  - [如何检测cookie是否有效（可选）](#如何检测cookie是否有效可选)
  - [API服务](#api服务)

## 功能
项目出于备份微博的初衷，旨在爬取指定用户（通过user_id）所有微博及相关转发、评论、点赞（可选）内容到本地，通过sqlite保存。为了便于查看，可以启动服务器端，按照m.weibo.cn类似的风格在本地复现。主要功能包括：
* 下载微博
* * 下载用户**原创和转发**的微博
* * 下载用户**原创和转发**微博下的评论（可选）
* * 下载用户**原创和转发**微博下的转发（可选）
* * 下载用户**原创和转发**微博下的点赞（可选）
* * 写入**SQLite数据库**
* 下载图片/视频
* * 下载用户**原创和转发**微博中的原始**图片**（可选）
* * 下载用户**原创和转发**微博中的**视频**（可选）

## 注意事项
* 为了支持“断点续爬”和持续更新，爬取微博按照时间顺序进行，默认原微博在整个爬取过程中不会进行删除（可以新增），若有已爬取的微博删除，可能会导致漏爬。另外这样的代价就是不支持只爬取部分时间段内的内容。
* 下载文件时文件名只保存了url的最后一段，可能有极小概率会出现不同文件重名的情况？如有必要可以考虑取更长的内容作为文件名（如整个url去掉不兼容的符号）。
* 所有url保留原始值，在复现的时候按规则转换成本地文件路径。
* 置顶微博认为它在时间线上仍存在，不作任何特殊处理，复现时不置顶。
* 由于微博评论格式调整（大约2016年7月前后），更早期的评论数据只能用另一种方式搬运，某些情况下无法完全获得（官网也不显示）。因为结合了两种方式，评论的创建时间格式不一样，需要在使用时区分处理。

## 特别感谢
本项目爬取方式综合参考了weibo-crawler和weiboSpider的爬取方式。